const request = require("request-promise");
require("dotenv").config();

async function requestToApi(endpoint, slug) {
  return await request({
    uri: `${process.env.WP_VULN_EXTERNAL_API}${endpoint}/${slug}`,
    headers: {
      'site': 'wpvuln.com',
      endpoint
    }
  });
}

module.exports = async function noticeToExternalService(newItems) {
  Object.keys(newItems).forEach(endpoint => {
    newItems[endpoint].forEach(async item => {
      await requestToApi(endpoint, item.name);
    });
  });
}